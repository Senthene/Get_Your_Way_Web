d3.floorplan=function(){function b(b){var p=k.range()[1]-k.range()[0],h=g.range()[1]-g.range()[0];b.each(function(b){if(b){var a=d3.select(this);l(a.selectAll("defs").data([0]).enter().append("defs"));var c=a.selectAll(".map-layers").data([0]),e=c.enter().append("g").attr("class","map-layers"),q=d3.transition(c);e.append("rect").attr("class","canvas").attr("pointer-events","all").style("opacity",0);q.attr("width",p).attr("height",h).attr("x",k.range()[0]).attr("y",g.range()[0]);e=a.selectAll(".map-controls").data([0]);
q=e.enter().append("g").attr("class","map-controls");d(q);var q=e.select(".hide").classed("ui-show-hide")?95:10,n=Math.max(45,10+20*f.length);e.attr("view-width",p).attr("transform","translate("+(p-q)+",0)").select("rect").attr("height",n);e=e.select("g.layer-controls").selectAll("g").data(f,function(a){return a.id()});q=e.enter().append("g").attr("class","ui-active").style("cursor","pointer").on("click",function(b){var c=d3.select(this);b=a.selectAll("g."+b.id());c.classed("ui-active")?(b.style("display",
"none"),c.classed("ui-active",!1).classed("ui-default",!0)):(b.style("display","inherit"),c.classed("ui-active",!0).classed("ui-default",!1))});q.append("rect").attr("x",0).attr("y",1).attr("rx",5).attr("ry",5).attr("width",75).attr("height",18).attr("stroke-width","1px");q.append("text").attr("x",10).attr("y",15).style("font-size","12px").style("font-family","Helvetica, Arial, sans-serif").text(function(a){return a.title()});e.transition().duration(1E3).attr("transform",function(a,b){return"translate(0,"+
20*(f.length-(b+1))+")"});c=c.selectAll(".maplayer").data(f,function(a){return a.id()});c.enter().append("g").attr("class",function(a){return"maplayer "+a.title()}).append("g").attr("class",function(a){return a.id()}).datum(null);c.exit().remove();c.order();c.each(function(a){d3.select(this).select("g."+a.id()).datum(b[a.id()]).call(a)});a.call(d3.behavior.zoom().scaleExtent([1,5]).on("zoom",function(){if(m){var b=d3.event.scale,c=d3.event.translate;a&&(b&&(a.__scale__=b),c&&1<c.length&&(a.__translate__=
c),b=(1-a.__scale__)*(k.range()[1]-k.range()[0]),c=(1-a.__scale__)*(g.range()[1]-g.range()[0]),a.__translate__[0]=Math.min(k.range()[0],Math.max(a.__translate__[0],b)),a.__translate__[1]=Math.min(g.range()[0],Math.max(a.__translate__[1],c)),a.selectAll(".map-layers").attr("transform","translate("+a.__translate__+")scale("+a.__scale__+")"))}}))}})}function l(a){a.each(function(){var a=d3.select(this),b=a.append("radialGradient").attr("id","metal-bump").attr("cx","50%").attr("cy","50%").attr("r","50%").attr("fx",
"50%").attr("fy","50%");b.append("stop").attr("offset","0%").style("stop-color","rgb(170,170,170)").style("stop-opacity",.6);b.append("stop").attr("offset","100%").style("stop-color","rgb(204,204,204)").style("stop-opacity",.5);a=a.append("pattern").attr("id","grip-texture").attr("patternUnits","userSpaceOnUse").attr("x",0).attr("y",0).attr("width",3).attr("height",3);a.append("rect").attr("height",3).attr("width",3).attr("stroke","none").attr("fill","rgba(204,204,204,0.5)");a.append("circle").attr("cx",
1.5).attr("cy",1.5).attr("r",1).attr("stroke","none").attr("fill","url(#metal-bump)")})}function d(a){a.each(function(){var a=d3.select(this);a.append("path").attr("class","ui-show-hide").attr("d","M10,3 v40 h-7 a3,3 0 0,1 -3,-3 v-34 a3,3 0 0,1 3,-3 Z").attr("fill","url(#grip-texture)").attr("stroke","none").style("opacity",.5);a.append("path").attr("class","show ui-show-hide").attr("d","M2,23 l6,-15 v30 Z").attr("fill","rgb(204,204,204)").attr("stroke","none").style("opacity",.5);a.append("path").attr("class",
"hide").attr("d","M8,23 l-6,-15 v30 Z").attr("fill","rgb(204,204,204)").attr("stroke","none").style("opacity",0);a.append("path").attr("d","M10,3 v40 h-7 a3,3 0 0,1 -3,-3 v-34 a3,3 0 0,1 3,-3 Z").attr("pointer-events","all").attr("fill","none").attr("stroke","none").style("cursor","pointer").on("mouseover",function(){a.selectAll("path.ui-show-hide").style("opacity",1)}).on("mouseout",function(){a.selectAll("path.ui-show-hide").style("opacity",.5)}).on("click",function(){a.select(".hide").classed("ui-show-hide")?
a.transition().duration(1E3).attr("transform","translate("+(a.attr("view-width")-10)+",0)").each("end",function(){a.select(".hide").style("opacity",0).classed("ui-show-hide",!1);a.select(".show").style("opacity",1).classed("ui-show-hide",!0);a.selectAll("path.ui-show-hide").style("opacity",.5)}):a.transition().duration(1E3).attr("transform","translate("+(a.attr("view-width")-95)+",0)").each("end",function(){a.select(".show").style("opacity",0).classed("ui-show-hide",!1);a.select(".hide").style("opacity",
1).classed("ui-show-hide",!0);a.selectAll("path.ui-show-hide").style("opacity",.5)})});a.append("rect").attr("x",10).attr("y",0).attr("width",85).attr("fill","rgba(204,204,204,0.9)").attr("stroke","none");a.append("g").attr("class","layer-controls").attr("transform","translate(15,5)")})}var f=[],m=!0,k=d3.scale.linear(),g=d3.scale.linear();b.xScale=function(a){if(!arguments.length)return k;k=a;f.forEach(function(a){a.xScale(k)});return b};b.yScale=function(a){if(!arguments.length)return g;g=a;f.forEach(function(a){a.yScale(g)});
return b};b.panZoom=function(a){if(!arguments.length)return m;m=a;return b};b.addLayer=function(a,d){a.xScale(k);a.yScale(g);1<arguments.length&&0<=d?f.splice(d,0,a):f.push(a);return b};return b};d3.floorplan.version="0.1.0";d3.floorplan.heatmap=function(){function b(a){a.each(function(a){if(a&&a.map){var b=d3.select(this);a.units?" "!=a.units.charAt(0)&&(a.units=" "+a.units):a.units="";var c=a.map.map(function(a){return a.value}).sort(d3.ascending),e,h;switch(d){case "quantile":e=d3.scale.quantile().range([1,2,3,4,5,6]).domain(c);h=e.quantiles();break;case "quantized":e=d3.scale.quantize().range([1,2,3,4,5,6]).domain([c[0],c[c.length-1]]);c=(e.domain()[1]-e.domain()[0])/6;h=[c,2*c,3*c,4*c,5*c];break;case "normal":var n=
d3.mean(c),c=Math.sqrt(d3.sum(c,function(a){return Math.pow(a-n,2)})/c.length);e=d3.scale.quantile().range([1,2,3,4,5,6]).domain([n-6*c,n-2*c,n-c,n,n+c,n+2*c,n+6*c]);h=e.quantiles();break;default:customThresholds||(customThresholds=h),c=customThresholds,c.push(c[c.length-1]),c.unshift(c[0]),e=d3.scale.quantile().range([1,2,3,4,5,6]).domain(c),customThresholds=h=e.quantiles()}b=b.selectAll("g.heatmap").data([0]);b.enter().append("g").attr("class","heatmap");this.__colors__&&this.__colors__!=l&&b.classed(this.__colors__,
!1);b.classed(l,!0);this.__colors__=l;c=b.selectAll("rect").data(a.map.filter(function(a){return!a.points}),function(a){return a.x+","+a.y});h=c.enter().append("rect").style("opacity",1E-6);c.exit().transition().style("opacity",1E-6).remove();h.append("title");c.attr("x",function(a){return f(a.x)}).attr("y",function(a){return m(a.y)}).attr("height",Math.abs(m(a.binSize)-m(0))).attr("width",Math.abs(f(a.binSize)-f(0))).attr("class",function(a){return"d6-"+e(a.value)}).select("title").text(function(b){return"value: "+
g(b.value)+a.units});h.transition().style("opacity",.6);c=b.selectAll("path").data(a.map.filter(function(a){return a.points}),function(a){return JSON.stringify(a.points)});h=c.enter().append("path").attr("d",function(a){return k(a.points)+"Z"}).style("opacity",1E-6);c.exit().transition().style("opacity",1E-6).remove();h.append("title");c.attr("class",function(a){return"d6-"+e(a.value)}).select("title").text(function(b){return"value: "+g(b.value)+a.units});h.transition().style("opacity",.6);b=b.selectAll("text").data(a.map.filter(function(a){return a.points}),
function(a){return JSON.stringify(a.points)});c=b.enter().append("text").style("font-weight","bold").attr("text-anchor","middle").style("opacity",1E-6);b.exit().transition().style("opacity",1E-6).remove();b.attr("transform",function(a){for(var b=0,c=0,h=0,e=0;e<a.points.length;++e)var g=a.points[e],d=a.points[e+1]||a.points[0],k=g.x*d.y-d.x*g.y,b=b+(g.x+d.x)*k,c=c+(g.y+d.y)*k,h=h+k;h/=2;c/=6*h;return"translate("+f(b/(6*h))+","+m(c)+")"}).text(function(b){return g(b.value)+a.units});c.transition().style("opacity",
.6)}})}var l="RdYlBu",d="quantile",f=d3.scale.linear(),m=d3.scale.linear(),k=d3.svg.line().x(function(a){return f(a.x)}).y(function(a){return m(a.y)}),g=d3.format(".4n"),a="fp-heatmap-"+(new Date).valueOf(),p="heatmap";b.xScale=function(a){if(!arguments.length)return f;f=a;return b};b.yScale=function(a){if(!arguments.length)return m;m=a;return b};b.colorSet=function(a){if(!arguments.length)return l;l=a;return b};b.colorMode=function(a){if(!arguments.length)return d;d=a;return b};b.customThresholds=
function(a){if(!arguments.length)return customThresholds;customThresholds=a;return b};b.id=function(){return a};b.title=function(a){if(!arguments.length)return p;p=a;return b};return b};d3.floorplan.imagelayer=function(){function b(b){b.each(function(b){b&&(b=d3.select(this).selectAll("image").data(b,function(a){return a.url}),b.enter().append("image").attr("xlink:href",function(a){return a.url}).style("opacity",1E-6),b.exit().transition().style("opacity",1E-6).remove(),b.transition().attr("x",function(a){return l(a.x)}).attr("y",function(a){return d(a.y)}).attr("height",function(a){return d(a.y+a.height)-d(a.y)}).attr("width",function(a){return l(a.x+a.width)-l(a.x)}).style("opacity",
function(a){return a.opacity||1}))})}var l=d3.scale.linear(),d=d3.scale.linear(),f="fp-imagelayer-"+(new Date).valueOf(),m="imagelayer";b.xScale=function(d){if(!arguments.length)return l;l=d;return b};b.yScale=function(f){if(!arguments.length)return d;d=f;return b};b.id=function(){return f};b.title=function(d){if(!arguments.length)return m;m=d;return b};return b};d3.floorplan.overlays=function(){function b(b){b.each(function(b){if(b){var c=d3.select(this),e=c.selectAll("rect.overlay-canvas").data([0]);e.enter().append("rect").attr("class","overlay-canvas").style("opacity",0).attr("pointer-events","all").on("click",function(){if(h){var a=d3.mouse(this);g.forEach(function(b){b(d.invert(a[0]),f.invert(a[1]))})}}).on("mouseup.drag",l).on("touchend.drag",l);e.attr("x",d.range()[0]).attr("y",f.range()[0]).attr("height",f.range()[1]-f.range()[0]).attr("width",d.range()[1]-
d.range()[0]);e=c.selectAll("path.polygon").data(b.polygons||[],function(a){return a.id});e.enter().append("path").attr("class","polygon").attr("vector-effect","non-scaling-stroke").attr("pointer-events","all").on("mousedown",function(b){a.forEach(function(a){a(b.id)})}).call(r).append("title");e.exit().transition().style("opacity",1E-6).remove();e.attr("d",function(a){return t(a.points)+"Z"}).style("cursor",h?"move":"pointer").select("title").text(function(a){return a.name||a.id});if(h){var k=[];
b.polygons&&b.polygons.forEach(function(a){a.points.forEach(function(b,c){k.push({index:c,parent:a})})});b=1;for(e=c.node();e.parentNode;)if(e=e.parentNode,e.__scale__){b=e.__scale__;break}c=c.selectAll("circle.vertex").data(k,function(a){return a.parent.id+"-"+a.index});c.exit().transition().attr("r",1E-6).remove();c.enter().append("circle").attr("class","vertex").attr("pointer-events","all").attr("vector-effect","non-scaling-stroke").style("cursor","move").attr("r",1E-6).call(r);c.attr("cx",function(a){return d(a.parent.points[a.index].x)}).attr("cy",
function(a){return f(a.parent.points[a.index].y)}).attr("r",4/b)}else c.selectAll("circle.vertex").transition().attr("r",1E-6).remove()}})}function l(){c&&(p.forEach(function(a){c.parent?a(c.parent.id,c.parent.points,c.index):a(c.id,c.points)}),c=null)}var d=d3.scale.linear(),f=d3.scale.linear(),m="fp-overlays-"+(new Date).valueOf(),k="overlays",g=[],a=[],p=[],h=!1,t=d3.svg.line().x(function(a){return d(a.x)}).y(function(a){return f(a.y)}),r=d3.behavior.drag().on("dragstart",function(a){h&&(c=a)}).on("drag",
function(){if(c){var a=d.invert(d3.event.dx)-d.invert(0),h=f.invert(d3.event.dy)-f.invert(0);c.parent?(c.parent.points[c.index].x+=a,c.parent.points[c.index].y+=h):c.points&&c.points.forEach(function(b){b.x+=a;b.y+=h});b(d3.select(this.parentNode))}}).on("dragend",l),c=null;b.xScale=function(a){if(!arguments.length)return d;d=a;return b};b.yScale=function(a){if(!arguments.length)return f;f=a;return b};b.id=function(){return m};b.title=function(a){if(!arguments.length)return k;k=a;return b};b.editMode=
function(a){if(!arguments.length)return h;h=a;return b};b.registerCanvasCallback=function(a){arguments.length&&g.push(a);return b};b.registerSelectCallback=function(c){arguments.length&&a.push(c);return b};b.registerMoveCallback=function(a){arguments.length&&p.push(a);return b};return b};d3.floorplan.pathplot=function(){function b(a){a.each(function(a){a&&(a=d3.select(this).selectAll("path").data(a,function(a){return a.id}),a.exit().transition().style("opacity",1E-6).remove(),a.enter().append("path").attr("vector-effect","non-scaling-stroke").attr("fill","none").style("opacity",1E-6).append("title"),a.attr("class",function(a){return a.classes||a.id}).attr("d",function(a,b){return f(g(a,b))}).select("title").text(function(a){return a.title||a.id}),a.transition().style("opacity",1))})}
var l=d3.scale.linear(),d=d3.scale.linear(),f=d3.svg.line().x(function(a){return l(a.x)}).y(function(a){return d(a.y)}),m="fp-pathplot-"+(new Date).valueOf(),k="pathplot",g=function(a){return a.points};b.xScale=function(a){if(!arguments.length)return l;l=a;return b};b.yScale=function(a){if(!arguments.length)return d;d=a;return b};b.id=function(){return m};b.title=function(a){if(!arguments.length)return k;k=a;return b};b.pointFilter=function(a){if(!arguments.length)return g;g=a;return b};return b};d3.floorplan.vectorfield=function(){function b(b){b.each(function(a){if(a&&a.map){var b=d3.select(this).selectAll("path.vector").data(a.map,function(a){return a.x+","+a.y});b.exit().transition().style("opacity",1E-6).remove();b.enter().append("path").attr("class","vector").attr("vector-effect","non-scaling-stroke").style("opacity",1E-6).append("title");var d=a.binSize/2/d3.max(a.map,function(a){return Math.max(Math.abs(a.value.x),Math.abs(a.value.y))});b.attr("d",function(b){var g={x:b.x+a.binSize/
2,y:b.y+a.binSize/2};return f([g,{x:g.x+b.value.x*d,y:g.y+b.value.y*d}])}).select("title").text(function(b){return Math.sqrt(b.value.x*b.value.x+b.value.y*b.value.y)+" "+a.units});b.transition().style("opacity",1)}})}var l=d3.scale.linear(),d=d3.scale.linear(),f=d3.svg.line().x(function(b){return l(b.x)}).y(function(b){return d(b.y)}),m="fp-vectorfield-"+(new Date).valueOf(),k="vectorfield";b.xScale=function(d){if(!arguments.length)return l;l=d;return b};b.yScale=function(f){if(!arguments.length)return d;
d=f;return b};b.id=function(){return m};b.title=function(b){if(!arguments.length)return k;k=b;return images};return b};
